ios:release:alpha:
  stage: release
  extends: .base-ios
  variables:
    PILOT_NOTIFY_EXTERNAL_TESTERS: "true"
    PILOT_DISTRIBUTE_EXTERNAL: "true"
    FASTLANE_APPLE_APPLICATION_SPECIFIC_PASSWORD: ${APP_SPECIFIC_PWD_FASTLANE}
    FL_SLACK_MESSAGE: "_*NEW IOS ALPHA RELEASE*_\n\n*Pipeline Url*\n${CI_PIPELINE_URL}\n"
    PILOT_GROUPS: "Maggioli-Internals"
    PILOT_IPA: iosApp/iosApp.ipa
    PILOT_CHANGELOG: ""
  script:
    - pod install
    - bundle exec fastlane build_app
    - bundle exec fastlane run upload_to_testflight
    - bundle exec fastlane run slack
  rules:
    - if: $CI_COMMIT_BRANCH == "dev"
      when: manual